<!-- python 100本ノック 学習用のファイル -->

<!--

import os
from google.colab import drive
drive.mount('/content/drive')

///   knock21   ///  データ概要確認

import pandas as pd
uselog = pd.read_csv("/content/drive/My Drive/100knock/use_log.csv")
print(len(uselog))
uselog.head()

customer = pd.read_csv("/content/drive/My Drive/100knock/customer_master.csv")
print(len(customer))
customer.head()

class_master = pd.read_csv("/content/drive/My Drive/100knock/class_master.csv")
print(len(class_master))
class_master.head()

campaign_master = pd.read_csv("/content/drive/My Drive/100knock/campaign_master.csv")
print(len(campaign_master))
campaign_master.head()


/// /// /// /// ///



///   knock22   ///  データ整形

データ結合
customer_join = pd.merge(customer, class_master, on = "class", how = "left")
customer_join = pd.merge(customer_join, campaign_master, on = "campaign_id", how = "left")
customer_join.head()

データ数の確認
print(len(customer))
print(len(customer_join))

欠損値の有無確認
customer_join.isnull().sum()

/// /// /// /// ///


///   knock23   ///  データ集計

customer_join.groupby("class_name").count()["customer_id"]
customer_join.groupby("campaign_name").count()["customer_id"]
customer_join.groupby("gender").count()["customer_id"]
customer_join.groupby("is_deleted").count()["customer_id"]

集計
groupby()
customer_id ごとにカウントする
is_deleted 在籍者0　退会者1


customer_join["start_date"] = pd.to_datetime(customer_join["start_date"])
customer_start = customer_join.loc[customer_join["start_date"] > pd.to_datetime("20180401")]
print(len(customer_start))

入会人数の確認
start_date列に記載されているユーザーが入会者。
実行すると、1361　が出力される。

/// /// /// /// ///


///   knock24   ///  データ基礎集計

customer_join["end_date"] = pd.to_datetime(customer_join["end_date"])
customer_newer = customer_join.loc[(customer_join["end_date"] >= pd.to_datetime("20190331"))|(customer_join["end_date"].isna())]
print(len(customer_newer))
customer_newer["end_date"].unique()

NaT datetime型の欠損値を意味する。このデータでは退会していない顧客を意味する

データ詳細の確認
customer_newer.groupby("class_name").count()["customer_id"]
customer_newer.groupby("campaign_name").count()["customer_id"]
customer_newer.groupby("gender").count()["customer_id"]

/// /// /// /// ///


///   knock25   ///  利用履歴集計

uselog["usedate"] = pd.to_datetime(uselog["usedate"])
uselog["年月"] = uselog["usedate"].dt.strftime("%Y%m")
uselog_months = uselog.groupby(["年月", "customer_id"], as_index = False).count()
uselog_months.rename(columns = {"log_id":"count"}, inplace = True)
del uselog_months["usedate"]
uselog_months.head()

年月でデータを作成
uselog["usedate"] = pd.to_datetime(uselog["usedate"])
uselog["年月"] = uselog["usedate"].dt.strftime("%Y%m")

年月と顧客データでgroupbyによる集計
uselog_months = uselog.groupby(["年月", "customer_id"], as_index = False).count()
uselog_months.rename(columns = {"log_id":"count"}, inplace = True)

利用日は不要なため削除
del uselog_months["usedate"]


uselog_customer = uselog_months.groupby("customer_id").agg(["mean", "median", "max", "min"])["count"]
uselog_customer = uselog_customer.reset_index(drop = False)
uselog_customer.head()

顧客ごとの絞り込み
顧客ごとの月内利用回数集計
groupbyによりindexにcustomer_id列があるため、indexを修正


/// /// /// /// ///


///   knock26   ///  定期利用






-->