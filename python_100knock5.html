<!-- python 100本ノック 学習用のファイル -->

<!--

import os
from google.colab import drive
drive.mount('/content/drive')

///   knock41   ///  データ読み込み、整形

import pandas as pd
customer = pd.read_csv("/content/drive/My Drive/100knock/customer_join4.csv")
uselog_months = pd.read_csv("/content/drive/My Drive/100knock/use_log_months4.csv")


year_months = list(uselog_months["年月"].unique())
uselog = pd.DataFrame()
for i in range(1, len(year_months)):
  tmp = uselog_months.loc[uselog_months["年月"] == year_months[i]].copy()
  tmp.rename(columns = {"count":"count_0"}, inplace = True)
  tmp_before = uselog_months.loc[uselog_months["年月"] == year_months[i-1]].copy()
  del tmp_before["年月"]
  tmp_before.rename(columns = {"count":"count_1"}, inplace = True)
  tmp = pd.merge(tmp, tmp_before, on = "customer_id", how = "left")
  uselog = pd.concat([uselog, tmp], ignore_index = True)
uselog.head()

短期退会者の傾向をつかむため、一か月前の状況から予測する


/// /// /// /// ///


///   knock42   ///  退会者、退会前月のデータ

from dateutil.relativedelta import relativedelta
exit_customer = customer.loc[customer["is_deleted"] == 1].copy()
exit_customer["exit_date"] = None
exit_customer["end_date"] = pd.to_datetime(exit_customer["end_date"])
for i in exit_customer.index:
  exit_customer.loc[i, "exit_date"] = exit_customer.loc[i, "end_date"] - relativedelta(months = 1)
exit_customer["exit_date"] = pd.to_datetime(exit_customer["exit_date"])
exit_customer["年月"] = exit_customer["exit_date"].dt.strftime("%Y%m")
uselog["年月"] = uselog["年月"].astype(str)
exit_uselog = pd.merge(uselog, exit_customer, on = ["customer_id", "年月"], how = "left")
print(len(uselog))
exit_uselog.head()

退会者に絞り込み
退会付きの一か月前の年月を取得
結合



exit_uselog = exit_uselog.dropna(subset = ["name"])
print(len(exit_uselog))
print(len(exit_uselog["customer_id"].unique()))
exit_uselog.head()

欠損値除去

/// /// /// /// ///




-->